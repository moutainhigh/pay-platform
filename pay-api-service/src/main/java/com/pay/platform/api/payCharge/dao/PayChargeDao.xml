<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.pay.platform.api.payCharge.dao.PayChargeDao">

    <select id="queryPayChannelByCode" parameterType="java.lang.String" resultType="java.util.Map">
        select * from tb_pay_channel
        where channel_code = #{code}
    </select>

    <select id="queryAgentRateByMerchantNo" parameterType="java.lang.String" resultType="java.util.Map">
        select ta.* , tar.rate as agentRate
        from tb_agent ta
        left join tb_agent_rate tar on tar.agent_id = ta.id and tar.channel_id = #{payChannelId}
        where ta.id in (
            select tm.agent_id from tb_merchant tm
            where tm.merchant_no = #{merchantNo}
        )
    </select>

    <select id="queryMerchantRateByMerchantNo" parameterType="java.lang.String" resultType="java.util.Map">
        select tm.* , tmr.rate as merchantRate
        from tb_merchant tm
        left join tb_merchant_rate tmr on tmr.merchant_id = tm.id and tmr.channel_id = #{payChannelId}
        where tm.merchant_no =  #{merchantNo}
    </select>

    <insert id="createOrder" parameterType="com.pay.platform.api.order.model.OrderModel">
      insert into tb_order
      (id	,merchant_order_no	,platform_order_no	,order_amount	,handling_fee	,actual_amount	,cost_rate	,channel_amount	,agent_rate
      	,platform_amount	,merchant_rate	,agent_amount	,merchant_id	,merchant_no	,agent_id	,channel_id	,pay_way	,create_time)
       values
       (uuid(),#{merchantOrderNo},#{platformOrderNo},#{orderAmount},#{handlingFee},#{actualAmount},#{costRate},#{channelAmount},#{agentRate}
       ,#{platformAmount},#{merchantRate},#{agentAmount},#{merchantId},#{merchantNo},#{agentId},#{channelId},#{payWay}, now())
    </insert>


</mapper>